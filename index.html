<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Absensi Rutinan Paskibra</title>

<!-- ===== STYLE BARU (CLEAN & MODERN) ===== -->
<style>
body { 
    font-family: 'Segoe UI', Arial, sans-serif; 
    background: #eef2f7; 
    margin:0; 
    padding:0; 
}

/* Header */
header{
    background:#2d6cdf;
    color:white;
    padding:18px;
    text-align:center;
    font-size:24px;
    font-weight:600;
    letter-spacing:1px;
    box-shadow:0 3px 10px rgba(0,0,0,0.15);
}

/* Card Container */
.container{
    max-width:480px;
    margin:35px auto;
    background:white;
    padding:28px;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
    animation: fadeIn 0.4s ease;
}

/* Fade animation */
@keyframes fadeIn{
    from{opacity:0; transform:translateY(10px);}
    to{opacity:1; transform:translateY(0);}
}

input, button, select{
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:8px;
    border:1.5px solid #cfd7e3;
    font-size:16px;
    transition:0.2s;
}

input:focus, select:focus{
    border-color:#2d6cdf;
    outline:none;
    box-shadow:0 0 6px rgba(45,108,223,0.35);
}

button{
    background:#2d6cdf;
    color:white;
    cursor:pointer;
    font-weight:bold;
    border:none;
    transition:0.2s;
}

button:hover{background:#1d4fb7;}
.link-btn{ background:#505b7a; }
.link-btn:hover{ background:#3c4663; }

.back-btn{ background:#777; }
.back-btn:hover{ background:#5f5f5f; }

/* Table */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
    font-size:15px;
}

th{
    background:#2d6cdf;
    color:white;
    padding:10px;
    text-align:left;
}

td{
    padding:10px;
    border-bottom:1px solid #ddd;
}

tr:hover td{
    background:#f1f4ff;
}

td button{
    padding:8px 12px;
    border-radius:6px;
    background:#cf2d2d;
    color:white;
    border:none;
    cursor:pointer;
    font-size:14px;
}
td button:hover{ background:#b32222; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<header>Absensi Rutinan</header>

<!-- Halaman Absen -->
<div class="container" id="absenPage">
  <h3>Form Absensi</h3>
  <p style="color:#555;font-size:14px;">
    <b>Informasi:</b> Absensi hanya bisa dilakukan <b>hari Selasa & Sabtu</b>, pukul <b>12:00 WIB sampai 19:00 WIB</b>.
  </p>

  <label>Nomor ID</label>
  <input type="text" id="userId" placeholder="Masukkan ID Anda...">

  <label>Keterangan</label>
  <select id="statusAbsen" onchange="toggleAlasanInput()">
    <option value="Hadir">Hadir</option>
    <option value="Izin">Izin</option>
  </select>

  <div id="alasanWrapper" style="display:none;">
    <label>Alasan Izin</label>
    <input type="text" id="alasanIzin" placeholder="Tuliskan alasan izin...">
  </div>

  <button onclick="submitAbsensi()">Apply Absen</button>
  <button class="link-btn" onclick="openAdmin()">Login Admin</button>

  <p style="color:red;font-weight:bold;" id="pesan"></p>
</div>

<!-- Halaman Login Admin -->
<div class="container" id="adminLogin" style="display:none;">
<h3>Login Admin</h3>
<label>Password</label>
<input type="password" id="adminPass" placeholder="Masukkan password admin">
<button onclick="loginAdmin()">Login</button>
<button class="back-btn" onclick="backToHome()">Kembali</button>
<p id="adminLoginMsg" style="color:red;"></p>
</div>

<!-- Halaman Admin Panel -->
<div class="container" id="adminPanel" style="display:none;">
<h3>Rekap Absensi</h3>
<table id="rekapTable">
<thead>
<tr><th>ID</th><th>Nama</th><th>Waktu</th><th>Status</th><th>Alasan</th><th>Aksi</th></tr>
</thead>
<tbody id="rekapBody"></tbody>
</table>
<button class="back-btn" onclick="logoutAdmin()">Keluar Admin</button>
</div>

<!-- ðŸ”Š SUARA NOTIFIKASI -->
<audio id="soundSuccess" src="https://raw.githubusercontent.com/satyawijaya242/sound/main/ssstik.io_1764400884057.mp3
"></audio>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCCheqFeLe-BS5ZZiyXLfmRVnyoDbmbMiM",
  authDomain: "absen-74c40.firebaseapp.com",
  databaseURL: "https://absen-74c40-default-rtdb.firebaseio.com",
  projectId: "absen-74c40",
  storageBucket: "absen-74c40.appspot.com",
  messagingSenderId: "962064220204",
  appId: "1:962064220204:web:8111b69ce31a5994f51189"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Data user
const registeredUsers = {
    "200409":"Zendi Prianto",
    "110810":"Ramadhan",
    "111109":"M. Hafidz Atallah",
    "070909":"Fardan Rakhmansyah",
    "220209":"M. Ali Subechan",
    "120108":"M. Khafidz Affandy",
    "280508":"Nanda Alfares",
    "210707":"Irwandy Yusuf",
    "300310":"M. Sahrul Mubarok",
    "270810":"Bening Putriyanah",
    "210809":"Elisa Agustina",
    "240310":"Assyifa Nur Khasanah",
    "231109":"Vanesa Gresia Putri",
    "060209":"Asti Dwi Febriani",
    "051209":"Rahmatul Salimah",
    "140210":"Izzah Wardatil Millah",
    "110310":"Nur Laeli Rahma Tullah",
    "110210":"Ainum Mahmudah",
    "180210":"Dian Fakhrotun Nisa",
    "140510":"Uyun Dwi Risquna",
    "070110":"Ratih Rus Sukmah Watih",
    "070310":"Fannes Aisha Putri",
    "200310":"Khafid Lutfi",
    "040210":"Ahmad Febian Pratama",
    "030110":"M. Rizky Aditya",
    "061108":"Naufal Rehan"
};

function toggleAlasanInput(){
    document.getElementById("alasanWrapper").style.display =
        (document.getElementById("statusAbsen").value === "Izin") ? "block" : "none";
}

function submitAbsensi(){
    const id = document.getElementById("userId").value.trim();
    const pesan = document.getElementById("pesan");
    const status = document.getElementById("statusAbsen").value;

    if(!id){ pesan.innerText="ID tidak boleh kosong!"; return; }
    if(!registeredUsers[id]){ pesan.innerText="ID tidak terdaftar!"; return; }

    const now = new Date();
    const hari = now.getDay();
    const jam = now.getHours();
    const menit = now.getMinutes();

    if(!(hari===2 || hari===6)){
        pesan.innerText="Absensi hanya hari Selasa & Sabtu!";
        return;
    }
    if(jam < 12 || (jam === 19 && menit > 0) || jam > 19){
        pesan.innerText="Jam absen 12:00 - 19:00 WIB!";
        return;
    }

    db.ref("absensi").once("value", snapshot=>{
        let sudah=false;

        snapshot.forEach(snap=>{
            const item=snap.val();
            const t=new Date(item.waktu);

            if(item.id===id &&
                t.getDate()==now.getDate() &&
                t.getMonth()==now.getMonth() &&
                t.getFullYear()==now.getFullYear()
            ){
                sudah=true;
            }
        });

        if(sudah){
            pesan.innerText="Anda sudah absen hari ini!";
            return;
        }

        const alasan = (status==="Izin")
            ? document.getElementById("alasanIzin").value.trim()
            : "-";

        if(status==="Izin" && !alasan){
            pesan.innerText="Alasan izin wajib diisi!";
            return;
        }

        simpanData(id, registeredUsers[id], now.toLocaleString(), status, alasan);
    });
}

function simpanData(id,nama,waktu,status,alasan){
    const pesan=document.getElementById("pesan");

    db.ref("absensi").push({
        id, nama, waktu, status, alasan
    }, err=>{
        if(err){
            pesan.innerText="Gagal absen!";
        } else {
            pesan.style.color="green";
            pesan.innerText="Absensi berhasil!";

            // ðŸ”Š MAIN SUARA NOTIFIKASI
            document.getElementById("soundSuccess").play();

            document.getElementById("userId").value="";
            document.getElementById("alasanIzin").value="";
        }
    });
}

function openAdmin(){
    document.getElementById("absenPage").style.display="none";
    document.getElementById("adminLogin").style.display="block";
}
function backToHome(){
    document.getElementById("adminLogin").style.display="none";
    document.getElementById("absenPage").style.display="block";
}
function loginAdmin(){
    if(document.getElementById("adminPass").value==="fourl"){
        document.getElementById("adminLogin").style.display="none";
        document.getElementById("adminPanel").style.display="block";
        loadRekap();
    } else {
        document.getElementById("adminLoginMsg").innerText="Password salah!";
    }
}
function logoutAdmin(){
    document.getElementById("adminPanel").style.display="none";
    document.getElementById("absenPage").style.display="block";
}

function loadRekap(){
    const body=document.getElementById("rekapBody");
    body.innerHTML="";

    db.ref("absensi").once("value", snapshot=>{
        snapshot.forEach(snap=>{
            const item=snap.val();
            const key=snap.key;

            body.innerHTML+=`
            <tr>
                <td>${item.id}</td>
                <td>${item.nama}</td>
                <td>${item.waktu}</td>
                <td>${item.status}</td>
                <td>${item.alasan}</td>
                <td><button onclick="hapusData('${key}')">Hapus</button></td>
            </tr>`;
        });
    });
}

function hapusData(key){
    db.ref("absensi/"+key).remove().then(()=>loadRekap());
}






/* =====================================================
   ðŸš¨ AUTO ABSEN 19:00 WIB
   ===================================================== */

function autoAbsen() {
    const now = new Date();
    const jam = now.getHours();
    const menit = now.getMinutes();

    if (jam !== 19 || menit !== 0) return;

    db.ref("absensi").once("value", snapshot => {
        const sudahAbsen = {};
        const today = new Date();

        snapshot.forEach(child => {
            const item = child.val();
            const t = new Date(item.waktu);

            const sameDate =
                t.getDate() === today.getDate() &&
                t.getMonth() === today.getMonth() &&
                t.getFullYear() === today.getFullYear();

            if (sameDate) sudahAbsen[item.id] = true;
        });

        Object.keys(registeredUsers).forEach(id => {
            if (!sudahAbsen[id]) {
                db.ref("absensi").push({
                    id: id,
                    nama: registeredUsers[id],
                    waktu: "19:00",
                    status: "Tidak Absen",
                    alasan: "Tanpa keterangan"
                });
            }
        });
    });
}

// Cek tiap 30 detik
setInterval(autoAbsen, 30000);



</script>

</body>
</html>


